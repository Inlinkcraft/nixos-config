#!/usr/bin/env bash
set -euo pipefail

THEME="${1:-default}"
THEME_DIR="$HOME/Configuration/themes/$THEME"

if [ ! -d "$THEME_DIR" ]; then
  echo "Theme '$THEME' not found in $THEME_DIR"
  exit 1
fi

IMAGE="$(find "$THEME_DIR" -type f \( -iname '*.jpg' -o -iname '*.png' \) | head -n 1)"

if [ -z "$IMAGE" ]; then
  echo "No wallpaper found in $THEME_DIR"
  exit 1
fi

echo "Applying theme '$THEME'"
echo "Wallpaper: $IMAGE"

# Generate + export pywal colors
wal -i "$IMAGE"

# Wallpaper
swww img "$IMAGE" --transition-type any

# Reload apps
hyprctl reload
pkill -SIGUSR2 waybar || true
alacritty msg config reload 2>/dev/null || true
